#!/bin/sh

FILENAME="/tmp/update-counter"

if [ -e "$FILENAME" ]; then
	if [ "$(cat $FILENAME)" = "-" ]; then
		UPD=$(checkupdates)
		COUNT=$(echo $UPD | wc -l)
	else
		current=$(date +%s)
		last_modified=$(stat -c "%Y" $FILENAME)
		if [ $(($current-$last_modified)) -gt 180 ]; then 
			UPD=$(checkupdates)
			COUNT=$(echo $UPD | wc -l)
			echo $UPD > $FILENAME
		else 
			UPD=$(cat $FILENAME)
			COUNT=$(echo $UPD | wc -l)
		fi
	fi
else
	UPD=$(checkupdates)
	COUNT=$(echo $UPD | wc -l)
	echo $UPD > $FILENAME
fi

if [ "$COUNT" -eq "0" ]; then
	CODE=28 #46
elif [ "$COUNT" -le "3" ]; then
	CODE=190
elif [ "$COUNT" -le "6" ]; then
	CODE=220
elif [ "$COUNT" -le "10" ]; then
	CODE=208
elif [ "$COUNT" -lt "25" ]; then
	CODE=208
elif [ "$COUNT" -lt "50" ]; then
	CODE=202
else 
	CODE=196
fi

# COLOR="[38;5;${CODE}m"
# END="[0m"
COLOR="#[fg=colour$CODE]"
END=""

if [ "$COUNT" -ne "1" ]; then
	S="s"
else
	NAME="($(echo $UPD | awk '{print $1}'))"
fi

echo "$COLOR$COUNT$END update$S $NAME"
